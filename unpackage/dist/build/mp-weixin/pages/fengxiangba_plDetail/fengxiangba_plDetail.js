(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/fengxiangba_plDetail/fengxiangba_plDetail"],{"0f30":function(e,t,a){},"27e3":function(e,t,a){"use strict";(function(e){a("10a4"),a("921b");o(a("66fd"));var t=o(a("4c0f"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,a("543d")["createPage"])},"294f":function(e,t,a){"use strict";var o=a("0f30"),n=a.n(o);n.a},"4c0f":function(e,t,a){"use strict";a.r(t);var o=a("b58e"),n=a("76a5");for(var i in n)"default"!==i&&function(e){a.d(t,e,function(){return n[e]})}(i);a("294f");var r=a("2877"),s=Object(r["a"])(n["default"],o["a"],o["b"],!1,null,null,null);t["default"]=s.exports},"6f17":function(e,t,a){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a={data:function(){return{Router:this.$Router,mainData:[],originData:{},Utils:this.$Utils,content:""}},onLoad:function(e){var t=this;t.id=e.id,t.paginate=t.$Utils.cloneForm(t.$AssetsConfig.paginate),t.$Utils.loadAll(["getOriginData","getUserInfoData"],t)},onReachBottom:function(){console.log("onReachBottom");var t=this;!t.isLoadAll&&e.getStorageSync("loadAllArray")&&(t.paginate.currentPage++,t.getMainData())},methods:{formIdAdd:function(e){var t=this;console.log(e),t.$apis.WxFormIdAdd(e.detail.formId,Date.parse(new Date)/1e3+604800)},getUserInfoData:function(){var t=this,a=new Date((new Date).setHours(0,0,0,0)).getTime()/1e3,o=Date.parse(new Date)/1e3,n={tokenFuncName:"getProjectToken"};n.searchItem={user_no:e.getStorageSync("user_info").user_no},n.getAfter={todayScore:{tableName:"FlowLog",searchItem:{create_time:["between",[a,o]],status:1,type:3,user_no:wx.getStorageSync("user_info").user_no,relation_table:"message"},middleKey:"user_no",key:"user_no",condition:"in",compute:{count:["sum","count",{create_time:["between",[a,o]],status:1,type:3,user_no:wx.getStorageSync("user_info").user_no,relation_table:"message",count:[">",0]}]}}};var i=function(e){e.info.data.length>0?t.userInfoData=e.info.data[0]:t.$Utils.showToast("没有更多了","none"),console.log("self.getUserInfoData",t.getUserInfoData),t.$Utils.finishFunc("getUserInfoData")};t.$apis.userInfoGet(n,i)},getOriginData:function(){var e=this,t={tokenFuncName:"getProjectToken"};t.searchItem={id:e.id},t.getAfter={followMe:{tableName:"Log",searchItem:{status:["in",[1,-1]],type:3,user_no:wx.getStorageSync("user_info").user_no},middleKey:"id",key:"relation_id",condition:"in"},likeMe:{tableName:"Log",searchItem:{status:["in",[1,-1]],type:1,user_no:wx.getStorageSync("user_info").user_no},middleKey:"id",key:"relation_id",condition:"in"},collectMe:{tableName:"Log",searchItem:{status:["in",[1,-1]],type:2,user_no:wx.getStorageSync("user_info").user_no},middleKey:"id",key:"relation_id",condition:"in"},like:{tableName:"Log",searchItem:{status:1,type:1,relation_table:"message"},middleKey:"id",key:"relation_id",condition:"in",compute:{count:["count","count",{status:1}]}},collect:{tableName:"Log",searchItem:{status:1,type:2,relation_table:"message"},middleKey:"id",key:"relation_id",condition:"in",compute:{count:["count","count",{status:1}]}},reply:{tableName:"Message",searchItem:{status:1,type:2},middleKey:"id",key:"message_id",condition:"in",compute:{count:["count","count",{status:1}]}}};var a=function(t){t.info.data.length>0&&(e.originData=t.info.data[0],e.getMainData(!0)),console.log("self.originData",e.originData),e.$Utils.finishFunc("getOriginData")};e.$apis.messageGet(t,a)},getMainData:function(e){var t=this;e&&(t.mainData=[],t.paginate={count:0,currentPage:1,is_page:!0,pagesize:5});var a={};a.paginate=t.$Utils.cloneForm(t.paginate),a.tokenFuncName="getProjectToken",a.searchItem={thirdapp_id:2,user_type:0,type:2,message_id:t.originData.id,relation_table:"message"};var o=function(e){e.info.data.length>0&&t.mainData.push.apply(t.mainData,e.info.data),console.log("self.mainData",t.mainData),t.$Utils.finishFunc("getMainData")};t.$apis.messageGet(a,o)},submit:function(){var t=this;if(e.setStorageSync("canClick",!1),""!=t.content)var a=!0;if(a){var o=function(e,a){t.mainImg=[],t.description=e.nickName,t.mainImg.push(e.avatarUrl),t.messageAdd(),console.log("user",e),console.log("res",a)};t.$Utils.getAuthSetting(o)}else e.setStorageSync("canClick",!0),t.$Utils.showToast("评论不能为空","none")},messageAdd:function(){var t=this,a=Date.parse(new Date);a=t.$Utils.timeto(a,"ymd-hms");var o={tokenFuncName:"getProjectToken"};wx.getStorageSync("user_info")&&wx.getStorageSync("user_info").headImgUrl||(o.refreshToken=!0),o.data={type:2,relation_id:t.originData.relation_id,title:t.description,mainImg:t.mainImg,content:t.content,relation_table:"message",message_id:t.originData.id},console.log("postData",o),parseInt(t.userInfoData.todayScore.count)<parseInt(e.getStorageSync("user_info").thirdApp.custom_rule.score_limit)&&(o.saveAfter=[{tableName:"FlowLog",FuncName:"add",data:{type:3,relation_id:t.originData.relation_id,relation_table:"message",trade_info:"评论奖励积分",user_no:e.getStorageSync("user_info").user_no,thirdapp_id:2,count:e.getStorageSync("user_info").thirdApp.custom_rule.favor}}],parseInt(t.userInfoData.todayScore.count)+parseInt(e.getStorageSync("user_info").thirdApp.custom_rule.favor)>parseInt(e.getStorageSync("user_info").thirdApp.custom_rule.score_limit)&&(o.saveAfter[0].data.count=e.getStorageSync("user_info").thirdApp.custom_rule.score_limit-t.userInfoData.todayScore.count),o.saveFunction=[{FuncName:"wxTemplate",searchItem:{user_no:e.getStorageSync("user_info").user_no},template:"获得积分提醒",data_arr:{keyword1:{value:"评论奖励积分"},keyword2:{value:e.getStorageSync("user_info").thirdApp.custom_rule.favor},keyword3:{value:a}},thirdapp_id:2}]),console.log("232",t.userInfoData.todayScore.count+e.getStorageSync("user_info").thirdApp.custom_rule.favor),console.log("211",e.getStorageSync("user_info").thirdApp.custom_rule.score_limit);var n=function(a){1e5==a.solely_code?(t.$Utils.showToast("评论成功","none"),t.content="",setTimeout(function(){t.getOriginData(),t.getUserInfoData()},1e3)):(e.setStorageSync("canClick",!0),t.$Utils.showToast(a.msg,"none",1e3))};t.$apis.messageAdd(o,n)},clickGood:function(t){var a=this;e.setStorageSync("canClick",!1),0==a.originData.likeMe.length?a.addGoodLog():a.updateGoodLog()},addGoodLog:function(){var t=this,a=Date.parse(new Date);a=t.$Utils.timeto(a,"ymd-hms");var o={};o.data={type:1,title:"点赞成功",relation_id:t.id,relation_table:"Message",user_no:e.getStorageSync("user_info").user_no},o.tokenFuncName="getProjectToken",parseInt(t.userInfoData.todayScore.count)<parseInt(e.getStorageSync("user_info").thirdApp.custom_rule.score_limit)&&(o.saveAfter=[{tableName:"FlowLog",FuncName:"add",data:{type:3,relation_id:t.originData.id,relation_table:"message",trade_info:"点赞奖励积分",user_no:e.getStorageSync("user_info").user_no,thirdapp_id:2,count:e.getStorageSync("user_info").thirdApp.custom_rule.favor}}],parseInt(t.userInfoData.todayScore.count)+parseInt(e.getStorageSync("user_info").thirdApp.custom_rule.favor)>parseInt(e.getStorageSync("user_info").thirdApp.custom_rule.score_limit)&&(o.saveAfter[0].data.count=e.getStorageSync("user_info").thirdApp.custom_rule.score_limit-t.userInfoData.todayScore.count),o.saveFunction=[{FuncName:"wxTemplate",searchItem:{user_no:e.getStorageSync("user_info").user_no},template:"获得积分提醒",data_arr:{keyword1:{value:"点赞奖励积分"},keyword2:{value:e.getStorageSync("user_info").thirdApp.custom_rule.favor},keyword3:{value:a}},thirdapp_id:2}]),parseInt(t.userInfoData.todayScore.count)+parseInt(e.getStorageSync("user_info").thirdApp.custom_rule.favor)>parseInt(e.getStorageSync("user_info").thirdApp.custom_rule.score_limit)&&(o.saveAfter[0].data.count=e.getStorageSync("user_info").thirdApp.custom_rule.score_limit-e.getStorageSync("user_info").thirdApp.custom_rule.favor);var n=function(a){1e5==a.solely_code?(t.originData.likeMe.push({status:1,id:a.info.id}),t.originData.like.count=t.originData.like.count+1,t.$Utils.showToast("点赞成功","none",1e3),console.log("self.originData",t.originData),setTimeout(function(){t.getUserInfoData()},1e3)):t.$Utils.showToast("点赞失败","none",1e3),e.setStorageSync("canClick",!0)};t.$apis.logAdd(o,n)},updateGoodLog:function(){var t=this,a={searchItem:{id:t.originData.likeMe[0].id},data:{status:-t.originData.likeMe[0].status},tokenFuncName:"getProjectToken"},o=function(a){e.setStorageSync("canClick",!0),1e5==a.solely_code?(t.originData.likeMe[0].status=-t.originData.likeMe[0].status,1==t.originData.likeMe[0].status?(t.originData.like.count=t.originData.like.count+1,t.$Utils.showToast("点赞成功","none",1e3)):(t.originData.like.count=t.originData.like.count-1,t.$Utils.showToast("取消成功","none",1e3))):t.$Utils.showToast(a.msg,"none",1e3)};t.$apis.logUpdate(a,o)}}};t.default=a}).call(this,a("543d")["default"])},"76a5":function(e,t,a){"use strict";a.r(t);var o=a("6f17"),n=a.n(o);for(var i in o)"default"!==i&&function(e){a.d(t,e,function(){return o[e]})}(i);t["default"]=n.a},b58e:function(e,t,a){"use strict";var o=function(){var e=this,t=e.$createElement;e._self._c;e._isMounted||(e.e0=function(t){return e.Utils.stopMultiClick(e.clickGood)},e.e1=function(t){return e.Utils.stopMultiClick(e.submit)})},n=[];a.d(t,"a",function(){return o}),a.d(t,"b",function(){return n})}},[["27e3","common/runtime","common/vendor"]]]);