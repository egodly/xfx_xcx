(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/fengxiangba_pl/fengxiangba_pl"],{"124d":function(e,t,o){"use strict";var a=o("c6ae"),n=o.n(a);n.a},"2c2e":function(e,t,o){"use strict";var a=function(){var e=this,t=e.$createElement;e._self._c;e._isMounted||(e.e0=function(t){return e.Utils.stopMultiClick(e.clickGood)},e.e1=function(t){return e.Utils.stopMultiClick(e.clickCollect)},e.e2=function(t){return e.Router.navigateTo({route:{path:"/pages/fengxiangba_plDetail/fengxiangba_plDetail?id="+t.currentTarget.dataset.id}})},e.e3=function(t){return e.Utils.stopMultiClick(e.submit)})},n=[];o.d(t,"a",function(){return a}),o.d(t,"b",function(){return n})},"67e5":function(e,t,o){"use strict";o.r(t);var a=o("2c2e"),n=o("df1b");for(var i in n)"default"!==i&&function(e){o.d(t,e,function(){return n[e]})}(i);o("124d");var s=o("2877"),r=Object(s["a"])(n["default"],a["a"],a["b"],!1,null,null,null);t["default"]=r.exports},"8be8":function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o={data:function(){return{Router:this.$Router,mainData:[],originData:{},Utils:this.$Utils,content:""}},onLoad:function(e){var t=this;t.id=e.id,t.paginate=t.$Utils.cloneForm(t.$AssetsConfig.paginate);var o=function(e){t.$Utils.loadAll(["getOriginData","getUserInfoData"],t)};t.$Token.getProjectToken(o,{refreshToken:!0})},onReachBottom:function(){console.log("onReachBottom");var t=this;!t.isLoadAll&&e.getStorageSync("loadAllArray")&&(t.paginate.currentPage++,t.getMainData())},methods:{previewImage:function(t){var o=this;o.isPre=!0,console.log(t),e.previewImage({urls:o.mainData.bannerImg,current:t,longPressActions:{itemList:["发送给朋友","保存图片","收藏"],success:function(e){console.log("选中了第"+(e.tapIndex+1)+"个按钮,第"+(e.index+1)+"张图片")},fail:function(e){console.log(e.errMsg)}}})},onShareAppMessage:function(e){console.log(e);var t=this;e.target.dataset.index;if("button"===e.from)return{title:t.originData.title,imageUrl:t.originData.bannerImg[0].url,desc:"小蜂拼拼社区团购",path:"/pages/fengxiangba_pl/fengxiangba_pl?id="+t.originData.id,success:function(e){console.log("转发成功:"+JSON.stringify(e))},fail:function(e){console.log("转发失败:"+JSON.stringify(e))}}},formIdAdd:function(e){var t=this;console.log(e),t.$apis.WxFormIdAdd(e.detail.formId,Date.parse(new Date)/1e3+604800)},getUserInfoData:function(){var t=this,o=new Date((new Date).setHours(0,0,0,0)).getTime()/1e3,a=Date.parse(new Date)/1e3,n={tokenFuncName:"getProjectToken"};n.searchItem={user_no:e.getStorageSync("user_info").user_no},n.getAfter={todayScore:{tableName:"FlowLog",searchItem:{create_time:["between",[o,a]],status:1,type:3,user_no:wx.getStorageSync("user_info").user_no,relation_table:"message"},middleKey:"user_no",key:"user_no",condition:"in",compute:{count:["sum","count",{create_time:["between",[o,a]],status:1,type:3,user_no:wx.getStorageSync("user_info").user_no,relation_table:"message",count:[">",0]}]}}};var i=function(e){e.info.data.length>0?t.userInfoData=e.info.data[0]:t.$Utils.showToast("没有更多了","none"),console.log("self.getUserInfoData",t.getUserInfoData),t.$Utils.finishFunc("getUserInfoData")};t.$apis.userInfoGet(n,i)},getOriginData:function(){var e=this,t={tokenFuncName:"getProjectToken"};t.searchItem={id:e.id},t.getAfter={followMe:{tableName:"Log",searchItem:{status:["in",[1,-1]],type:3,user_no:wx.getStorageSync("user_info").user_no},middleKey:"user_no",key:"relation_user",condition:"in"},likeMe:{tableName:"Log",searchItem:{status:["in",[1,-1]],type:1,user_no:wx.getStorageSync("user_info").user_no},middleKey:"id",key:"relation_id",condition:"in"},collectMe:{tableName:"Log",searchItem:{status:["in",[1,-1]],type:2,user_no:wx.getStorageSync("user_info").user_no},middleKey:"id",key:"relation_id",condition:"in"},like:{tableName:"Log",searchItem:{status:1,type:1,relation_table:"message"},middleKey:"id",key:"relation_id",condition:"in",compute:{count:["count","count",{status:1}]}},collect:{tableName:"Log",searchItem:{status:1,type:2,relation_table:"message"},middleKey:"id",key:"relation_id",condition:"in",compute:{count:["count","count",{status:1}]}},reply:{tableName:"Message",searchItem:{status:1,type:2},middleKey:"id",key:"relation_id",condition:"in",compute:{count:["count","count",{status:1}]}}};var o=function(t){t.info.data.length>0?(e.originData=t.info.data[0],e.getMainData(!0)):e.$Utils.showToast("没有更多了","none"),console.log("self.originData",e.originData),e.$Utils.finishFunc("getOriginData")};e.$apis.messageGet(t,o)},clickFollow:function(){var t=this;if(e.setStorageSync("canClick",!1),t.originData.user_no==e.getStorageSync("user_info").user_no)return e.setStorageSync("canClick",!0),void t.$Utils.showToast("不能关注自己","none",1e3);0==t.originData.follow.length?t.addFollowLog():t.updateFollowLog()},addFollowLog:function(t){var o=this,a=Date.parse(new Date);a=o.$Utils.timeto(a,"ymd-hms");var n={};n.data={type:3,title:"关注成功",relation_user:o.originData.user_no,relation_table:"User",user_no:e.getStorageSync("user_info").user_no},n.tokenFuncName="getProjectToken",n.saveFunction=[{FuncName:"wxTemplate",searchItem:{user_no:o.originData.user_no},template:"关注提醒",data_arr:{keyword1:{value:o.originData.description},keyword2:{value:""!=e.getStorageSync("user_info").nickname?e.getStorageSync("user_info").nickname:"用户"+e.getStorageSync("user_info").user_no},keyword3:{value:a},keyword4:{value:"你发布的文章，有用户关注啦!"}},thirdapp_id:2}];var i=function(t){1e5==t.solely_code?(o.originData.follow.push({status:1,id:t.info.id}),o.$Utils.showToast("关注成功","none",1e3)):o.$Utils.showToast("关注失败","none",1e3),e.setStorageSync("canClick",!0)};o.$apis.logAdd(n,i)},updateFollowLog:function(){var t=this,o=Date.parse(new Date);o=t.$Utils.timeto(o,"ymd-hms");var a={searchItem:{id:t.originData.follow[0].id},data:{status:-t.originData.follow[0].status},tokenFuncName:"getProjectToken"};-1==t.mainData[index].follow[0].status&&(a.saveFunction=[{FuncName:"wxTemplate",searchItem:{user_no:t.originData.user_no},template:"关注提醒",data_arr:{keyword1:{value:t.originData.description},keyword2:{value:""!=e.getStorageSync("user_info").nickname?e.getStorageSync("user_info").nickname:"用户"+e.getStorageSync("user_info").user_no},keyword3:{value:o},keyword4:{value:"你发布的文章，有用户关注啦!"}},thirdapp_id:2}]);var n=function(o){e.setStorageSync("canClick",!0),1e5==o.solely_code?(t.originData.follow[0].status=-t.originData.follow[0].status,1==t.originData.follow[0].status?t.$Utils.showToast("关注成功","none",1e3):t.$Utils.showToast("取消成功","none",1e3)):t.$Utils.showToast(o.msg,"none",1e3)};t.$apis.logUpdate(a,n)},getMainData:function(e){var t=this;e&&(t.mainData=[],t.paginate={count:0,currentPage:1,is_page:!0,pagesize:5});var o={};o.paginate=t.$Utils.cloneForm(t.paginate),o.tokenFuncName="getProjectToken",o.searchItem={thirdapp_id:2,user_type:0,type:2,relation_id:t.originData.id,relation_table:"message",message_id:0},o.getAfter={likeMe:{tableName:"Log",searchItem:{status:["in",[1,-1]],type:1,user_no:wx.getStorageSync("user_info").user_no},middleKey:"id",key:"relation_id",condition:"in"},like:{tableName:"Log",searchItem:{status:1,type:1,relation_table:"message"},middleKey:"id",key:"relation_id",condition:"in",compute:{count:["count","count",{status:1}]}},reply:{tableName:"Message",searchItem:{status:1,type:2},middleKey:"id",key:"message_id",condition:"in"},replyCount:{tableName:"Message",searchItem:{status:1,type:2},middleKey:"id",key:"message_id",condition:"in",compute:{count:["count","count",{status:1}]}}};var a=function(e){e.info.data.length>0&&t.mainData.push.apply(t.mainData,e.info.data),console.log("self.mainData",t.mainData),t.$Utils.finishFunc("getMainData")};t.$apis.messageGet(o,a)},submit:function(){var t=this;if(e.setStorageSync("canClick",!1),""!=t.content)var o=!0;if(o){var a=function(e,o){t.mainImg=[],t.description=e.nickName,t.mainImg.push(e.avatarUrl),t.messageAdd(),console.log("user",e),console.log("res",o)};t.$Utils.getAuthSetting(a)}else e.setStorageSync("canClick",!0),t.$Utils.showToast("评论不能为空","none")},messageAdd:function(){var t=this,o=Date.parse(new Date);o=t.$Utils.timeto(o,"ymd-hms");var a={tokenFuncName:"getProjectToken"};wx.getStorageSync("user_info")&&wx.getStorageSync("user_info").headImgUrl||(a.refreshToken=!0),a.data={type:2,relation_id:t.originData.id,title:t.description,mainImg:t.mainImg,content:t.content,relation_table:"message"},console.log("postData",a),parseInt(t.userInfoData.todayScore.count)<parseInt(e.getStorageSync("user_info").thirdApp.custom_rule.score_limit)&&(a.saveAfter=[{tableName:"FlowLog",FuncName:"add",data:{type:3,relation_id:t.originData.id,relation_table:"message",trade_info:"评论奖励积分",user_no:e.getStorageSync("user_info").user_no,thirdapp_id:2,count:e.getStorageSync("user_info").thirdApp.custom_rule.favor}}],parseInt(t.userInfoData.todayScore.count)+parseInt(e.getStorageSync("user_info").thirdApp.custom_rule.favor)>parseInt(e.getStorageSync("user_info").thirdApp.custom_rule.score_limit)&&(a.saveAfter[0].data.count=e.getStorageSync("user_info").thirdApp.custom_rule.score_limit-t.userInfoData.todayScore.count),a.saveFunction=[{FuncName:"wxTemplate",searchItem:{user_no:e.getStorageSync("user_info").user_no},template:"获得积分提醒",data_arr:{keyword1:{value:"评论奖励积分"},keyword2:{value:e.getStorageSync("user_info").thirdApp.custom_rule.favor},keyword3:{value:o}},thirdapp_id:2}]);var n=function(o){1e5==o.solely_code?(t.$Utils.showToast("评论成功","none"),t.content="",setTimeout(function(){t.getOriginData(),t.getUserInfoData()},1e3)):(e.setStorageSync("canClick",!0),t.$Utils.showToast(o.msg,"none",1e3))};t.$apis.messageAdd(a,n)},clickGood:function(t){var o=this;e.setStorageSync("canClick",!1),0==o.originData.likeMe.length?o.addGoodLog():o.updateGoodLog()},addGoodLog:function(){var t=this,o=Date.parse(new Date);o=t.$Utils.timeto(o,"ymd-hms");var a={};a.data={type:1,title:"点赞成功",relation_id:t.id,relation_table:"Message",user_no:e.getStorageSync("user_info").user_no},a.tokenFuncName="getProjectToken",parseInt(t.userInfoData.todayScore.count)<parseInt(e.getStorageSync("user_info").thirdApp.custom_rule.score_limit)&&(a.saveAfter=[{tableName:"FlowLog",FuncName:"add",data:{type:3,relation_id:t.originData.id,relation_table:"message",trade_info:"点赞奖励积分",user_no:e.getStorageSync("user_info").user_no,thirdapp_id:2,count:e.getStorageSync("user_info").thirdApp.custom_rule.favor}}],parseInt(t.userInfoData.todayScore.count)+parseInt(e.getStorageSync("user_info").thirdApp.custom_rule.favor)>parseInt(e.getStorageSync("user_info").thirdApp.custom_rule.score_limit)&&(a.saveAfter[0].data.count=e.getStorageSync("user_info").thirdApp.custom_rule.score_limit-t.userInfoData.todayScore.count),a.saveFunction=[{FuncName:"wxTemplate",searchItem:{user_no:e.getStorageSync("user_info").user_no},template:"获得积分提醒",data_arr:{keyword1:{value:"点赞奖励积分"},keyword2:{value:e.getStorageSync("user_info").thirdApp.custom_rule.favor},keyword3:{value:o}},thirdapp_id:2}]);var n=function(o){1e5==o.solely_code?(t.originData.likeMe.push({status:1,id:o.info.id}),t.originData.like.count=t.originData.like.count+1,t.$Utils.showToast("点赞成功","none",1e3),console.log("self.originData",t.originData),setTimeout(function(){t.getUserInfoData()},1e3)):t.$Utils.showToast("点赞失败","none",1e3),e.setStorageSync("canClick",!0)};t.$apis.logAdd(a,n)},updateGoodLog:function(){var t=this,o={searchItem:{id:t.originData.likeMe[0].id},data:{status:-t.originData.likeMe[0].status},tokenFuncName:"getProjectToken"},a=function(o){e.setStorageSync("canClick",!0),1e5==o.solely_code?(t.originData.likeMe[0].status=-t.originData.likeMe[0].status,1==t.originData.likeMe[0].status?(t.originData.like.count=t.originData.like.count+1,t.$Utils.showToast("点赞成功","none",1e3)):(t.originData.like.count=t.originData.like.count-1,t.$Utils.showToast("取消成功","none",1e3))):t.$Utils.showToast(o.msg,"none",1e3)};t.$apis.logUpdate(o,a)},clickCollect:function(t){var o=this;e.setStorageSync("canClick",!1),0==o.originData.collectMe.length?o.addCollectLog():o.updateCollectLog()},addCollectLog:function(){var t=this,o={};o.data={type:2,title:"收藏成功",relation_id:t.id,relation_table:"Message",user_no:e.getStorageSync("user_info").user_no},o.tokenFuncName="getProjectToken";var a=function(o){1e5==o.solely_code?(t.originData.collectMe.push({status:1,id:o.info.id}),t.originData.collect.count=t.originData.collect.count+1,t.$Utils.showToast("收藏成功","none",1e3),console.log("self.originData",t.originData)):t.$Utils.showToast("收藏失败","none",1e3),e.setStorageSync("canClick",!0)};t.$apis.logAdd(o,a)},updateCollectLog:function(){var t=this,o={searchItem:{id:t.originData.collectMe[0].id},data:{status:-t.originData.collectMe[0].status},tokenFuncName:"getProjectToken"},a=function(o){e.setStorageSync("canClick",!0),1e5==o.solely_code?(t.originData.collectMe[0].status=-t.originData.collectMe[0].status,1==t.originData.collectMe[0].status?(t.originData.collect.count=t.originData.collect.count+1,t.$Utils.showToast("收藏成功","none",1e3)):(t.originData.collect.count=t.originData.collect.count-1,t.$Utils.showToast("取消成功","none",1e3))):t.$Utils.showToast(o.msg,"none",1e3)};t.$apis.logUpdate(o,a)}}};t.default=o}).call(this,o("543d")["default"])},c6ae:function(e,t,o){},c7a5:function(e,t,o){"use strict";(function(e){o("10a4"),o("921b");a(o("66fd"));var t=a(o("67e5"));function a(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("543d")["createPage"])},df1b:function(e,t,o){"use strict";o.r(t);var a=o("8be8"),n=o.n(a);for(var i in a)"default"!==i&&function(e){o.d(t,e,function(){return a[e]})}(i);t["default"]=n.a}},[["c7a5","common/runtime","common/vendor"]]]);