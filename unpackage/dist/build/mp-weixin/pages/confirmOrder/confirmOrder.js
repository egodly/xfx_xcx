(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/confirmOrder/confirmOrder"],{"098a":function(e,t,o){},9126:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o={data:function(){return{Router:this.$Router,Utils:this.$Utils,addressData:{},mainData:[],totalPrice:0,userInfoData:{},transportFee:0,specialProvince:[],type:"",num:1,shopData:{},pay:{coupon:[]},array:[],couponData:[],couponIndex:-1,showCoupon:!1,group_no:"",leader_no:"",chooseCoupon:[],isBargain:!1}},onLoad:function(t){var o=this;e.setStorageSync("canClick",!0);var a=1,n=parseInt(e.getStorageSync("user_info").thirdApp.custom_rule.two),r=e.getStorageSync("user_info").thirdApp.custom_rule.three-e.getStorageSync("user_info").thirdApp.custom_rule.two,s=e.getStorageSync("user_info").thirdApp.custom_rule.four-e.getStorageSync("user_info").thirdApp.custom_rule.three,i=e.getStorageSync("user_info").thirdApp.custom_rule.five-e.getStorageSync("user_info").thirdApp.custom_rule.four,c=e.getStorageSync("user_info").thirdApp.custom_rule.six-e.getStorageSync("user_info").thirdApp.custom_rule.five;o.mainData=e.getStorageSync("payPro"),console.log("self.data.mainData",o.mainData),o.type=t.type,console.log("self.type",o.type),o.array=[a,n,r,s,i,c],t.leader_no&&(o.leader_no=t.leader_no),e.getStorageSync("group_no")&&(o.group_no=e.getStorageSync("group_no")),t.order_id&&(o.orderId=t.order_id,o.price=t.price,o.isBargain=!0),console.log("self.array",o.array),o.specialProvince=e.getStorageSync("user_info").thirdApp.codeName.split("-"),console.log("self.specialProvince",o.specialProvince),o.$Utils.loadAll(["getUserInfoData","getUserCouponData"],o)},onShow:function(){var t=this;e.getStorageSync("chooseShopData")&&(t.shopData=e.getStorageSync("chooseShopData")),e.getStorageSync("choosedAddressData")?(t.addressData=e.getStorageSync("choosedAddressData"),t.specialProvince.indexOf(t.addressData.province)>=0?t.transportFee=e.getStorageSync("user_info").thirdApp.custom_rule.special:t.transportFee=e.getStorageSync("user_info").thirdApp.custom_rule.freight):t.getAddressData(),t.specialProvince.indexOf(t.addressData.province)>=0?(console.log(21321),t.transportFee=e.getStorageSync("user_info").thirdApp.custom_rule.special):t.transportFee=e.getStorageSync("user_info").thirdApp.custom_rule.freight,t.countTotalPrice(),console.log("self.shopData",t.shopData)},methods:{formIdAdd:function(e){var t=this;console.log(e),t.$apis.WxFormIdAdd(e.detail.formId,Date.parse(new Date)/1e3+604800)},isShowCoupon:function(){var e=this;e.showCoupon=!e.showCoupon},useCoupon:function(e){var t=this;console.log(e);var o=t.couponData[e].id;t.couponIndex=-1;var a=t.$Utils.findItemInArray(t.couponData,"id",o),n=t.$Utils.findItemInArray(t.pay.coupon,"id",o);if(console.log("findCoupon",a),t.showCoupon=!1,t.pay.coupon.length>=1&&(t.pay.coupon=[],t.chooseCoupon=[]),a){a=a[1];var r=t.$Utils.findItemsInArray(t.pay.coupon,"product_id",o);if(n)t.pay.coupon.splice(n[0],1),t.chooseCoupon=[];else{if(console.log("self.data.price - self.data.couponTotalPrice",t.totalPrice-t.couponTotalPrice),console.log("findCoupon.condition",a.condition),t.totalPrice-t.couponTotalPrice<a.condition)return void t.$Utils.showToast("未达满减标准","none");if(console.log("findSameCoupon.length",r.length),t.pay.coupon.length>=1)return void t.$Utils.showToast("叠加使用超限","none");if(1==a.type){var s=a.value;console.log("findCoupon.discount",a.discount)}else if(2==a.type)s=parseFloat(t.totalPrice).toFixed(2)-parseFloat(a.discount/100*t.totalPrice).toFixed(2);parseFloat(s)+parseFloat(t.couponTotalPrice)>parseFloat(t.totalPrice)&&(s=parseFloat(t.totalPrice).toFixed(2)-parseFloat(t.couponTotalPrice).toFixed(2)),t.pay.coupon.push({id:o,price:s.toFixed(2)}),t.chooseCoupon.push({id:o,price:s}),t.showCoupon=!1,t.couponIndex=e}t.countTotalPrice()}else t.$Utils.showToast("优惠券错误","none")},getUserCouponData:function(){var e=this,t=(Date.parse(new Date),{tokenFuncName:"getProjectToken",searchItem:{use_step:1,type:["in",[1,2]]}}),o=function(t){t.info.data.length>0&&e.couponData.push.apply(e.couponData,t.info.data),e.orderId?e.$Utils.finishFunc("getUserCouponData"):e.getProductCouponData()};e.$apis.userCouponGet(t,o)},getProductCouponData:function(){var e=this,t=(Date.parse(new Date),{tokenFuncName:"getProjectToken",searchItem:{use_step:1,type:["in",[1,2]]}});t.getBefore={coupon:{tableName:"CouponRelation",searchItem:{product_no:["in",[e.mainData.sku[0].sku.product.product_no]]},middleKey:"coupon_no",key:"coupon_no ",condition:"in"}};var o=function(t){t.info.data.length>0&&e.couponData.push.apply(e.couponData,t.info.data),e.$Utils.finishFunc("getUserCouponData")};e.$apis.userCouponGet(t,o)},getUserInfoData:function(){var t=this;console.log("852369");var o=Date.parse(new Date)/1e3,a={tokenFuncName:"getProjectToken"};a.searchItem={user_no:e.getStorageSync("user_info").user_no},a.getAfter={orderCount:{tableName:"Order",searchItem:{create_time:["between",[e.getStorageSync("user_info").info.vip_time,o]],status:1,type:1,pay_status:1},middleKey:"user_no",key:"user_no",condition:"in",compute:{count:["count","count",{create_time:["between",[e.getStorageSync("user_info").info.vip_time,o]],status:1,type:1,pay_status:1}]}}};var n=function(e){1e5==e.solely_code&&e.info.data[0]?t.userInfoData=e.info.data[0]:t.$Utils.showToast(e.msg,"none"),t.$Utils.finishFunc("getUserInfoData")};t.$apis.userInfoGet(a,n)},changeType:function(e){var t=this;t.num!=e&&(t.num=e,t.countTotalPrice())},submit:function(){var t=this;if(e.setStorageSync("canClick",!1),1==t.num)if("{}"==JSON.stringify(t.shopData))e.setStorageSync("canClick",!0),t.$Utils.showToast("请选择自提门店","none");else if(t.orderId){var o=function(e,o){t.updateOrder()};t.$Utils.getAuthSetting(o)}else{var a=function(e,o){t.addOrder()};t.$Utils.getAuthSetting(a)}else if("{}"==JSON.stringify(t.addressData))e.setStorageSync("canClick",!0),t.$Utils.showToast("请选择收货地址","none");else if(t.orderId){var n=function(e,o){t.updateOrder()};t.$Utils.getAuthSetting(n)}else{var r=function(e,o){t.addOrder()};t.$Utils.getAuthSetting(r)}},updateOrder:function(){var t=this,o=(Date.parse(new Date),{tokenFuncName:"getProjectToken"});wx.getStorageSync("user_info")&&wx.getStorageSync("user_info").headImgUrl||(o.refreshToken=!0),o.data={},o.searchItem={id:t.orderId},1==t.num?(o.data.transport_type=2,o.data.shop_no=t.shopData.user_no):(o.data.transport_type=1,o.data.transport_fee=t.transportFee,o.snap_address=t.addressData);var a=function(o){o&&1e5==o.solely_code?t.payNow():(e.setStorageSync("canClick",!0),e.showToast({title:o.msg,duration:2e3}))};t.$apis.orderUpdate(o,a)},addOrder:function(){var t=this,o=Date.parse(new Date),a=t.$Utils.cloneForm(t.mainData);a.tokenFuncName="getProjectToken",wx.getStorageSync("user_info")&&wx.getStorageSync("user_info").headImgUrl||(a.refreshToken=!0),a.data={},1==t.num?(a.data.transport_type=2,a.data.shop_no=t.shopData.user_no):(a.data.transport_type=1,a.data.transport_fee=t.transportFee,a.snap_address=t.addressData),2==t.type&&(a.isGroup=!0,a.data.standard=t.mainData.sku[0].sku.product.standard,console.log(t.mainData.sku[0].sku.product.duration),console.log(o),a.data.invalid_time=parseFloat(t.mainData.sku[0].sku.product.duration)+parseFloat(o)),""!=t.leader_no&&(a.data.leader_no=t.leader_no),""!=t.group_no&&(a.group_no=t.group_no);var n=function(o){o&&1e5==o.solely_code?(t.orderId=o.info.id,t.payNow()):(e.setStorageSync("canClick",!0),e.showToast({title:o.msg,duration:2e3}))};t.$apis.addOrder(a,n)},payNow:function(t){var o=this,a=o.$Utils.cloneForm(o.pay);a.tokenFuncName="getProjectToken",a.searchItem={id:o.orderId};for(var n=0;n<o.array.length;n++)n==parseInt(o.userInfoData.level)&&parseInt(o.array[n])-parseInt(o.userInfoData.orderCount.count)<=1&&(a.payAfter=[{tableName:"UserInfo",FuncName:"update",data:{level:o.userInfoData.level+1,vip_time:Date.parse(new Date)/1e3},searchItem:{user_no:e.getStorageSync("user_info").user_no}}]);var r=function(t){if(1e5==t.solely_code)if(e.setStorageSync("canClick",!0),e.removeStorageSync("group_no"),t.info){var a=function(t){console.log("payData",t),1==t?(e.showToast({title:"支付成功",duration:1e3,success:function(){}}),setTimeout(function(){o.$Router.redirectTo({route:{path:"/pages/myOrder/myOrder"}})},1e3)):(e.setStorageSync("canClick",!0),e.showToast({title:"支付失败",duration:2e3}))};o.$Utils.realPay(t.info,a)}else e.showToast({title:"支付成功",duration:1e3,success:function(){}}),setTimeout(function(){o.$Router.redirectTo({route:{path:"/pages/myOrder/myOrder"}})},1e3);else e.setStorageSync("canClick",!0),e.showToast({title:t.msg,duration:2e3})};o.$apis.pay(a,r)},getAddressData:function(){var t=this,o={tokenFuncName:"getProjectToken",searchItem:{isdefault:1}},a=function(o){o.info.data.length>0&&(t.addressData=o.info.data[0],t.specialProvince.indexOf(t.addressData.province)>=0?(console.log(21321),t.transportFee=e.getStorageSync("user_info").thirdApp.custom_rule.special):t.transportFee=e.getStorageSync("user_info").thirdApp.custom_rule.freight)};t.$apis.addressGet(o,a)},counter:function(e,t){var o=this;"+"==t?o.mainData.sku[e].count++:o.mainData.sku[e].count>1&&o.mainData.sku[e].count--,o.countTotalPrice()},countTotalPrice:function(){var e=this;if(e.totalPrice=0,e.couponTotalPrice=e.$Utils.addItemInArray(e.pay.coupon,"price"),e.orderId)e.totalPrice=e.price;else for(var t=0;t<e.mainData.sku.length;t++)1==e.type?e.totalPrice+=e.mainData.sku[t].sku.price*e.mainData.sku[t].count:2==e.type&&(e.totalPrice+=e.mainData.sku[t].sku.group_price*e.mainData.sku[t].count),console.log("self.pay",e.pay);var o=parseFloat(e.totalPrice)-parseFloat(e.couponTotalPrice);o>0?e.pay.wxPay={price:o.toFixed(2)}:delete e.pay.wxPay,2==e.num&&(e.pay.wxPay.price=parseFloat(e.pay.wxPay.price)+parseFloat(e.transportFee))}}};t.default=o}).call(this,o("543d")["default"])},a00f:function(e,t,o){"use strict";(function(e){o("10a4"),o("921b");a(o("66fd"));var t=a(o("b898"));function a(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("543d")["createPage"])},b898:function(e,t,o){"use strict";o.r(t);var a=o("e5e3"),n=o("f3e2");for(var r in n)"default"!==r&&function(e){o.d(t,e,function(){return n[e]})}(r);o("be7e");var s=o("2877"),i=Object(s["a"])(n["default"],a["a"],a["b"],!1,null,null,null);t["default"]=i.exports},be7e:function(e,t,o){"use strict";var a=o("098a"),n=o.n(a);n.a},e5e3:function(e,t,o){"use strict";var a=function(){var e=this,t=e.$createElement;e._self._c;e._isMounted||(e.e0=function(t){return e.Router.navigateTo({route:{path:"/pages/myZiTiAddress/myZiTiAddress"}})},e.e1=function(t){return e.Router.navigateTo({route:{path:"/pages/myAddress/myAddress"}})},e.e2=function(t){return e.Utils.stopMultiClick(e.submit)})},n=[];o.d(t,"a",function(){return a}),o.d(t,"b",function(){return n})},f3e2:function(e,t,o){"use strict";o.r(t);var a=o("9126"),n=o.n(a);for(var r in a)"default"!==r&&function(e){o.d(t,e,function(){return a[e]})}(r);t["default"]=n.a}},[["a00f","common/runtime","common/vendor"]]]);